<div class="step-container">
  <mat-vertical-stepper [linear]="False" (selectionChange)="onStepChange($event)" #stepper>
    <mat-step editable="true" label="Upload Attachments">
      <div gdGap="20px" gdColumns="repeat(2, [col] 30vw)" gdRows="repeat(2, [row] auto)">
        <div class="box" gdColumn="col" gdRow="row">
          Common Attachments
        </div>
        <div class="box" gdColumn="col 2" gdRow="row">
          <input type="file" name="commonAttachments" ng2FileSelect [uploader]="commonAttachmentUploader" multiple
            placeholder="Input" />
        </div>
        <div class="box" gdColumn="col" gdRow="row 2">
          Individual Attachments
        </div>
        <div class="box" gdColumn="col 2" gdRow="row 2">
          <input type="file" name="individualAttachments" ng2FileSelect [uploader]="individualAttachmentUploader" multiple
            placeholder="Input" />
        </div>
      </div>
      <button mat-stroked-button matStepperNext>Done Uploading</button>
    </mat-step>

    <mat-step editable="true" label="Customize Attachments">

      <div class="attachment-selector-container">
        <div fxLayout="row" fxFill fxLayout.xs="column" fxLayoutGap="10px" fxLayoutAlign.xs="center center"
          fxLayoutWrap>
          <div fxFlex="50" style="overflow: auto" fxFill>
            <table mat-table [dataSource]="sheetContents" class="mat-elevation-z1">
              <div *ngFor="let header of headers">
                <ng-container matColumnDef="{{header}}">
                  <th mat-header-cell *matHeaderCellDef> {{header}} </th>
                  <td mat-cell *matCellDef="let element"> {{element[header]}} </td>
                </ng-container>
              </div>
              <tr mat-header-row *matHeaderRowDef="headers"></tr>
              <tr mat-row *matRowDef="let row; columns: headers;"
                [ngClass]="{'highlight-table-row': selectedRow == row}" (click)="onClickRow(row)"></tr>
            </table>
          </div>
          <div fxFlex="50" fxFill>
            <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutAlign.xs="center center" fxLayoutWrap>
              <div fxFlex>
                <div *ngIf="!selectedRow">
                  <p>
                    Select a row
                  </p>
                </div>
                <div *ngIf="selectedRow">
                  Pick the correct attachment for <strong>{{selectedRowSubject}}</strong>:
                  <br>
                  <mat-radio-group class="attachment-candidate-list" [(ngModel)]="selectedAttachmentCandidate">
                    <mat-radio-button class="attachment-candidate-list-item"
                      *ngFor="let candidate of attachmentCandidatesForSelectedRow" value="{{candidate}}"
                      (click)="onSelectCandidatePDF(candidate)">
                      {{candidate}}
                    </mat-radio-button>
                  </mat-radio-group>
                </div>
              </div>
            </div>
            <div fxFill fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutAlign.xs="center center"
              fxLayoutWrap *ngIf="selectedAttachmentCandidate">
              <div fxFlex>
                <div class="pdf-btn-group">
                  <button mat-raised-button (click)="onClickRotate('ANTICLOCKWISE')">
                    <i class="material-icons btn-icon">rotate_left</i>Rotate Left
                  </button>
                  <button mat-raised-button (click)="onClickRotate('CLOCKWISE')">
                    <i class="material-icons btn-icon">rotate_right</i>Rotate Right
                  </button>
                  <button mat-raised-button color="primary" (click)="onSelectAttachmentCandidate()">
                    <i class="material-icons btn-icon">save</i>Save
                  </button>
                </div>
                <br />
                <div *ngIf="selectedPDFViewerHTML" [innerHTML]="selectedPDFViewerHTML" class="embedded-pdf-viewer">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-step>

    <mat-step editable="true" label="Summary">
      <div class="summary-table-container">
        <table mat-table [dataSource]="sheetContents" class="mat-elevation-z1">
          <div *ngFor="let header of headers">
            <ng-container matColumnDef="{{header}}">
              <th mat-header-cell *matHeaderCellDef> {{header}} </th>
              <td mat-cell *matCellDef="let element"> {{element[header]}} </td>
            </ng-container>
          </div>
          <tr mat-header-row *matHeaderRowDef="headers"></tr>
          <tr mat-row *matRowDef="let row; columns: headers;"></tr>
        </table>
      </div>
    </mat-step>
  </mat-vertical-stepper>
</div>

<app-error-dialog #errorDialog></app-error-dialog>
